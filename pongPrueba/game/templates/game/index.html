<!DOCTYPE html>
<html>
<head>
    <title>Pong Game</title>
    <style>
        canvas {
            background: black;
            display: block;
            margin: auto;
        }
    </style>
</head>
<body>
    <canvas id="pongCanvas" width="800" height="400"></canvas>
    <script>
        const canvas = document.getElementById('pongCanvas');
        const context = canvas.getContext('2d');
        const paddleWidth = 10, paddleHeight = 100, ballSize = 10;

        let socket = new WebSocket('ws://' + window.location.host + '/ws/game/');

        socket.onmessage = function(event) {
            let data = JSON.parse(event.data);
            drawEverything(data);
        };

        document.addEventListener('keydown', (event) => {
            let message = null;
            switch (event.key) {
                case 'w':
                    message = {'type': 'move', 'player': 1, 'direction': 'up'};
                    break;
                case 's':
                    message = {'type': 'move', 'player': 1, 'direction': 'down'};
                    break;
                case 'ArrowUp':
                    message = {'type': 'move', 'player': 2, 'direction': 'up'};
                    break;
                case 'ArrowDown':
                    message = {'type': 'move', 'player': 2, 'direction': 'down'};
                    break;
            }
            if (message) {
                socket.send(JSON.stringify(message));
            }
        });

        function drawRect(x, y, width, height, color) {
            context.fillStyle = color;
            context.fillRect(x, y, width, height);
        }

        function drawCircle(x, y, radius, color) {
            context.fillStyle = color;
            context.beginPath();
            context.arc(x, y, radius, 0, Math.PI * 2, true);
            context.closePath();
            context.fill();
        }

        function drawNet() {
            for (let i = 0; i < canvas.height; i += 15) {
                drawRect(canvas.width / 2 - 1, i, 2, 10, 'white');
            }
        }

        function drawEverything(gameState) {
            context.clearRect(0, 0, canvas.width, canvas.height);
            drawRect(0, 0, canvas.width, canvas.height, 'black');
            drawNet();
            drawRect(0, gameState.player1Y, paddleWidth, paddleHeight, 'white');
            drawRect(canvas.width - paddleWidth, gameState.player2Y, paddleWidth, paddleHeight, 'white');
            drawCircle(gameState.ballX, gameState.ballY, ballSize, 'white');
        }
    </script>
</body>
</html>
